<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Abnormal Characteristics Form</title>
    <style>
        .sub-checkboxes {
            margin-left: 20px;
        }
        .error {
            color: red;
        }
    </style>
</head>
<body>

<form id="milkForm">
    <!-- Required Fields -->
    <label for="PersonInCharge">Person in Charge:</label>
    <input type="text" id="PersonInCharge" name="PersonInCharge" required><br>

    <label for="MilkTankNum">Milk Tank Number:</label>
    <input type="text" id="MilkTankNum" name="MilkTankNum" required><br>

    <label for="Quantity">Quantity:</label>
    <input type="number" id="Quantity" name="Quantity" required><br>

    <label for="QuantityUnit">Quantity Unit:</label>
    <select id="QuantityUnit" name="QuantityUnit" required>
        <option value="Liter">Liter</option>
        <option value="Milliliter">Milliliter</option>
    </select><br>

    <label for="Temperature">Temperature:</label>
    <input type="number" id="Temperature" name="Temperature" required><br>

    <label for="TemperatureUnit">Temperature Unit:</label>
    <select id="TemperatureUnit" name="TemperatureUnit" required>
        <option value="Celsius">Celsius</option>
        <option value="Fahrenheit">Fahrenheit</option>
    </select><br>

    <!-- Main Checkbox for Abnormal Characteristics -->
    <label for="MainQualityRM6">Abnormal characteristics:</label>
    <input type="checkbox" id="MainQualityRM6" name="MainQualityRM6" value="stWrong" onclick="toggleSubCheckboxes('MainQualityRM6', 'subCheckboxes')">

    <!-- Sub-checkboxes -->
    <div id="subCheckboxes" class="sub-checkboxes" style="display:none;">
        <input type="checkbox" name="abnormal_characteristics[]" value="SmellBad" id="subCheckbox1">
        <label for="subCheckbox1">Smell bad</label><br>

        <input type="checkbox" name="abnormal_characteristics[]" value="SmellNotFresh" id="subCheckbox2">
        <label for="subCheckbox2">Smell not fresh</label><br>

        <input type="checkbox" name="abnormal_characteristics[]" value="AbnormalColor" id="subCheckbox3">
        <label for="subCheckbox3">Abnormal color such as yellow or green</label><br>

        <input type="checkbox" name="abnormal_characteristics[]" value="SourTaste" id="subCheckbox4">
        <label for="subCheckbox4">Sour taste</label><br>

        <input type="checkbox" name="abnormal_characteristics[]" value="BitterTaste" id="subCheckbox5">
        <label for="subCheckbox5">Bitter taste</label><br>

        <input type="checkbox" name="abnormal_characteristics[]" value="CloudyAppearance" id="subCheckbox6">
        <label for="subCheckbox6">Cloudy appearance</label><br>

        <input type="checkbox" name="abnormal_characteristics[]" value="LumpyAppearance" id="subCheckbox7">
        <label for="subCheckbox7">Lumpy appearance</label><br>

        <input type="checkbox" name="abnormal_characteristics[]" value="SeparationBetweenWaterAndFat" id="subCheckbox8">
        <label for="subCheckbox8">There is a separation between water and fat</label>
    </div>

    <button type="submit">Submit</button>
    <div id="errorMessages" class="error"></div>
</form>

<script>
    function toggleSubCheckboxes(checkboxId, subTextId) {
        const checkbox = document.getElementById(checkboxId);
        const subText = document.getElementById(subTextId);
        if (checkbox.checked) {
            subText.style.display = 'block';
        } else {
            subText.style.display = 'none';
            const subCheckboxes = document.querySelectorAll(`#${subTextId} input[type="checkbox"]`);
            subCheckboxes.forEach(cb => cb.checked = false);
        }
    }

    document.getElementById('milkForm').addEventListener('submit', function (event) {
        event.preventDefault(); // Prevent the default form submission

        const formData = new FormData(this); // Create FormData object

        // Collect abnormal characteristics
        const abnormalCharacteristics = [];
        const checkboxes = document.querySelectorAll('input[name="abnormal_characteristics[]"]:checked');

        checkboxes.forEach((checkbox) => {
            abnormalCharacteristics.push(checkbox.value);
        });

        // Append the collected characteristics to FormData
        if (abnormalCharacteristics.length > 0) {
            formData.append('abnormal_characteristics_info', abnormalCharacteristics.join(',')); // Join with commas
        }

        // Log the form data
        console.log('Form Data:', Array.from(formData.entries())); // Check what is being sent

        // Make your fetch request or XHR here
        fetch('/submit', {
            method: 'POST',
            body: formData,
        })
        .then(response => response.json())
        .then(data => {
            console.log(data); // Log the server response
        })
        .catch(error => {
            console.error('Error:', error); // Log any errors
        });
    });
</script>

</body>
</html>
