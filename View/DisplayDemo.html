<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Display Raw Milk Data</title>
    <link rel="stylesheet" href="DemoStyle.css">
</head>
<body>
    <h1>Raw Milk Data</h1>
    <table id="dataTable">
        <thead>
            <tr>
                <th>Field</th>
                <th>Value</th>
            </tr>
        </thead>
        <tbody>
            <tr>
                <td>Person in Charge</td>
                <td id="displayPersonInCharge"></td>
            </tr>
            <tr>
                <td>Milk Tank Number</td>
                <td id="displayMilkTankNum"></td>
            </tr>
            <tr>
                <td>Quantity</td>
                <td id="displayQuantity"></td>
            </tr>
            <tr>
                <td>Quantity Unit</td>
                <td id="displayQuantityUnit"></td>
            </tr>
            <tr>
                <td>Temperature</td>
                <td id="displayTemperature"></td>
            </tr>
            <tr>
                <td>Temperature Unit</td>
                <td id="displayTemperatureUnit"></td>
            </tr>
            <tr>
                <td>pH</td>
                <td id="displayQualityPh"></td>
            </tr>
            <tr>
                <td>Fat</td>
                <td id="displayQualityFat"></td>
            </tr>
            <tr>
                <td>Protein</td>
                <td id="displayQualityProtein"></td>
            </tr>
            <tr>
                <td>Bacterial Testing</td>
                <td id="displayBacterialTesting"></td>
            </tr>
            <tr>
                <td>Contaminants</td>
                <td id="displayContaminants"></td>
            </tr>
            <tr>
                <td>Abnormal Characteristics</td>
                <td id="displayAbnormalCharacteristics"></td>
            </tr>
            <tr>
                <td>Address</td>
                <td id="displayAddress"></td>
            </tr>
            <tr>
                <td>Location</td>
                <td id="displayLocation"></td>
            </tr>
        </tbody>
    </table>

        <div class="QRCandBC">
            <h1>QR Code and Barcode Generator</h1>
    
            <div class="Barcode">
            <!-- Input Field to Simulate Barcode Scan -->
            <h2>Scan Barcode (Simulated)</h2>
            <input type="text" id="barcodeInput" placeholder="Scan Barcode or enter ID">
            <button onclick="scanBarcode()">Scan Barcode</button>
            </div>
            
            <div class="QRcode">
                <!-- Input Field to Simulate QR Code Scan -->
            <h2>Scan QR Code (Simulated)</h2>
            <input type="text" id="qrInput" placeholder="Scan QR Code or enter data">
            <button onclick="scanQRCode()">Scan QR Code</button>
            </div>
            
        
            
        </div>
        <!-- Displays QR Code and Barcode -->
        <div id="qrcode"></div>
        <div id="barcode"></div>
    
        <!-- Script and Libraries -->
        <script src="https://cdn.jsdelivr.net/npm/qrcode/build/qrcode.min.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/jsbarcode/dist/JsBarcode.all.min.js"></script>
        
        <script>
            // Global JSON Data to store scanned info
            let scannedData = {
                "barcodeData": "",
                "qrCodeData": ""
            };
    
            // Function to simulate scanning Barcode
            function scanBarcode() {
                const barcodeInput = document.getElementById("barcodeInput").value;
                if (barcodeInput) {
                    scannedData.barcodeData = barcodeInput; // Save the scanned barcode data
                    displayBarcode(); // Show the barcode
                } else {
                    alert("Please enter data to scan.");
                }
            }
    
            // Function to simulate scanning QR Code
            function scanQRCode() {
                const qrInput = document.getElementById("qrInput").value;
                if (qrInput) {
                    scannedData.qrCodeData = qrInput; // Save the scanned QR code data
                    displayQRCode(); // Show the QR Code
                } else {
                    alert("Please enter data to scan.");
                }
            }
    
            // Function to display the Barcode
            function displayBarcode() {
                const barcodeContainer = document.getElementById("barcode");
                barcodeContainer.innerHTML = ""; // Clear any previous barcode
                JsBarcode(barcodeContainer, scannedData.barcodeData, {
                    format: "CODE128",
                    displayValue: true
                });
            }
    
            // Function to display the QR Code
            function displayQRCode() {
                const qrCodeContainer = document.getElementById("qrcode");
                qrCodeContainer.innerHTML = ""; // Clear any previous QR code
                QRCode.toCanvas(qrCodeContainer, scannedData.qrCodeData, function (error) {
                    if (error) console.error(error);
                });
            }
    
            // Generate QR and Barcode when data is scanned and stored
            function generateQRCodeBarcode() {
                // Example data that would be generated upon scanning
                const qrData = "https://www.example.com";
                const barcodeData = "123456789012";
    
                // Update JSON with scanned data
                scannedData.qrCodeData = qrData;
                scannedData.barcodeData = barcodeData;
    
                // Show QR Code and Barcode
                displayQRCode();
                displayBarcode();
            }
            async function fetchMilkData() {
            try {
                const response = await fetch('/raw-milk-data');
                if (!response.ok) throw new Error('Network response was not ok');
                const data = await response.json();
                
                // Debugging: Log the data received
                console.log('Fetched Data:', data);

                // Update the DOM with the fetched data
                document.getElementById('displayPersonInCharge').textContent = data.person_in_charge || 'N/A';
                document.getElementById('displayMilkTankNum').textContent = data.milk_tank_number || 'N/A';
                document.getElementById('displayQuantity').textContent = data.quantity || 'N/A';
                document.getElementById('displayQuantityUnit').textContent = data.quantity_unit || 'N/A';
                document.getElementById('displayTemperature').textContent = data.temperature || 'N/A';
                document.getElementById('displayTemperatureUnit').textContent = data.temperature_unit || 'N/A';
                document.getElementById('displayQualityPh').textContent = data.quality_ph || 'N/A';
                document.getElementById('displayQualityFat').textContent = data.quality_fat || 'N/A';
                document.getElementById('displayQualityProtein').textContent = data.quality_protein || 'N/A';
                document.getElementById('displayBacterialTesting').textContent = data.bacterial_testing ? "Negative" : "Positive";
                document.getElementById('displayContaminants').textContent = data.contaminants ? "None" : "Present";
                document.getElementById('displayAbnormalCharacteristics').textContent = (data.sour_taste ? "Sour Taste, " : "") +
                    (data.bitter_taste ? "Bitter Taste, " : "") +
                    (data.cloudy_appearance ? "Cloudy Appearance, " : "") +
                    (data.lumpy_appearance ? "Lumpy Appearance, " : "") +
                    (data.water_and_fat ? "Water and Fat, " : "") +
                    (data.smell_bad ? "Bad Smell, " : "") +
                    (data.smell_not_fresh ? "Not Fresh, " : "") +
                    (data.abnormal_color ? "Abnormal Color" : "") || 'None';
                document.getElementById('displayAddress').textContent = data.address || 'N/A';
                document.getElementById('displayLocation').innerHTML = `<a href="${data.location_url}" target="_blank">Google Maps Link</a>` || 'N/A';
            } catch (error) {
                console.error('Error fetching data: ', error);
                alert('Failed to fetch data from the server.');
            }
        }

        // Fetch data on page load
        window.onload = fetchMilkData; generateQRCodeBarcode;
        </script>
</body>
</html>
